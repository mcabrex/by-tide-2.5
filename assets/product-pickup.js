class ProductPickup extends HTMLElement{constructor(){super()}connectedCallback(){this.init="true"===this.getAttribute("data-load-first-variant"),this.product_title=this.getAttribute("data-title"),this.pickup_drawer_container=document.querySelector('.off-canvas--container[data-view="pickup"]'),this.root=this.closest(`[data-product-id='${this.dataset.id}']`),this.initPickup(),this.updatePickupListener()}initPickup(){this.init?this.getPickupForm(this.dataset.firstVariantId):this.parentNode.setAttribute("data-empty",!0)}updatePickupListener(){this.root.on("variantUpdated",t=>{t=t.detail;t&&t.available&&"shopify"===t.inventory_management?this.getPickupForm(t.id):"shopify"===t.inventory_management&&t.available||this.removeOldForm()})}async getPickupForm(t){this.setAttribute("data-loading",!0);const e=await fetch(theme.urls.root+`/variants/${t}/?section_id=pickup`);if(!e.ok)throw new Error(e.statusText);var t=await e.text(),i=theme.utils.parseHtml(t,".pickup--form--container");if(this.removeOldForm(),this.setAttribute("data-loading",!1),i){this.appendChild(i),this.parentNode.setAttribute("data-empty",!1);const a=theme.utils.parseHtml(t,".pickup--drawer--container");a.querySelector(".pickup--drawer--product-title").innerText=this.product_title,"true"===this.getAttribute("data-is-only-variant")&&(a.querySelector(".pickup--drawer--variant-title").style.display="none"),this.pickup_drawer_container.appendChild(a),theme.off_canvas.reset()}}removeOldForm(){this.parentNode.setAttribute("data-empty",!0),this.pickup_drawer_container.innerHTML="",this.innerHTML=""}}customElements.define("product-pickup-root",ProductPickup);