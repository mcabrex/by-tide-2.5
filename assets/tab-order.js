export default class Transition{constructor(e=!1,t=!1){this.mobile_order_elements=this.getElementList(e),this.desktop_order_elements=this.getElementList(t),this.tabbing=!1,this.detectTabbing(),this.updateOrderList(),this.focusListener(),this.resizeListener()}detectTabbing(){window.off("click.TabOrder, keydown.TabOrder"),window.on("click.TabOrder",()=>this.tabbing=!1),window.on("keydown.TabOrder",e=>{9===e.which&&(this.tabbing=!0)})}getElementList(e){if(e){const s=[];return e.forEach(e=>{const t=document.querySelectorAll(e);t.length&&t.forEach(e=>s.push(e))}),s}return!1}updateOrderList(){"small"===theme.mqs.current_window?(this.current_order_elements=this.mobile_order_elements,this.previous_order_elements=this.desktop_order_elements):(this.current_order_elements=this.desktop_order_elements,this.previous_order_elements=this.mobile_order_elements)}focusListener(){this.current_order_elements&&this.current_order_elements.on("focusout",e=>this.focusOutCallback(e.target,e.target.index(),e))}focusOutCallback(e,t,s){this.tabbing&&((e=!e.contains(s.relatedTarget)&&"closed"===theme.off_canvas.state)&&theme.a11y.tab_forwards?this.moveFocus(t+1,"forwards"):e&&this.moveFocus(t-1,"backwards"))}moveFocus(e,t){var s=this.current_order_elements[e];const r=theme.a11y.getFocusableEl(s);e<this.current_order_elements.length&&"forwards"===t&&(r?r[0].focus():e+1<this.current_order_elements.length&&this.moveFocus(e+1,"forwards")),0<=e&&"backwards"===t&&(r?r[r.length-1].focus():0<=e-1&&this.moveFocus(e-1,"backwards"))}disableFocus(){this.previous_order_elements&&this.previous_order_elements.off("focusout")}resizeListener(){window.on("theme:mqs:updated",()=>{this.updateOrderList(),this.focusListener(),this.disableFocus()})}}