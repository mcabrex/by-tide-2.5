export default class ProductMedia extends HTMLElement{constructor(){super()}connectedCallback(){this.magnify=parseFloat(this.getAttribute("data-magnify")),this.main_media=this.querySelectorAll(".product-media--featured"),this.media_container=this.querySelector(".product-media--wrapper"),this.thumbs=this.querySelectorAll('[data-view="thumb-container"] .product-media--thumb'),this.zoom_enabled="true"===this.getAttribute("data-zoom-enabled"),this.zoom_images=this.querySelectorAll(".product-media--zoom-image"),this.updateMediaListener(),this.zoom_enabled&&this.zoom_images.length&&this.initZoomListener(),this.thumbs.length&&this.thumbNavigation()}disconnectedCallback(){this.off("variantUpdated.ProductMedia"),window.off("resize.ProductMedia"),this.thumbs.on("keypress.ProductMedia click.ProductMedia")}updateMediaListener(){this.on("variantUpdated.ProductMedia",e=>{e=e.detail;let t=0;e&&e.featured_media&&(t=parseInt(e.featured_media.id)),this.updateVariantMedia(t)})}updateVariantMedia(t){0!==t&&(this.main_media.forEach(e=>{parseInt(e.getAttribute("data-id"))===t?(e.setAttribute("data-active",!0),e.parentNode.style.display="block"):(e.setAttribute("data-active",!1),e.parentNode.style.display="none")}),this.thumbs.forEach(e=>{parseInt(e.getAttribute("data-id"))===t?e.setAttribute("data-active",!0):e.setAttribute("data-active",!1)}),this.zoom_enabled&&this.imageZoom())}imageZoom(){const i=this.getActiveZoomImage();if(i&&(i.style.display="none"),this.media_container.off("mouseenter.ProductMedia.ImageZoom mouseleave.ProductMedia.ImageZoom mousemove"),!(this.main_media.length<1||"small"===theme.mqs.current_window))if(i){this.media_container.setAttribute("data-media-type","image");var e=this.media_container.offsetWidth,t=this.media_container.offsetHeight,a=e*this.magnify,d=t*this.magnify;const o=this.media_container.offset(),r=(i.style.width=a+"px",i.querySelector(".image--root").style.width=a+"px",i.querySelector("img").classList.add("lazypreload"),(a-e)/e),s=(d-t)/t;this.media_container.on("mouseenter.ProductMedia.ImageZoom",()=>i.style.display="block"),this.media_container.on("mouseleave.ProductMedia.ImageZoom",()=>i.style.display="none"),this.media_container.on("mousemove",e=>{var t=e.pageX-o.left,e=e.pageY-o.top;i.style.left=t*-r+"px",i.style.top=e*-s+"px"})}else this.media_container.setAttribute("data-media-type","")}getActiveZoomImage(){return this.media_container.querySelector('.product-media--featured[data-active="true"]').nextElementSibling}initZoomListener(){window.on("resize.ProductMedia",theme.utils.debounce(100,()=>this.imageZoom()))}thumbNavigation(){this.thumbs.on("keypress.ProductMedia click.ProductMedia",e=>{if(theme.a11y.click(e)){const t=this.querySelector('.product-media--featured[data-active="true"] > *');t&&t.trigger("pauseMedia");e=parseInt(e.target.getAttribute("data-id"));this.updateVariantMedia(e);const i=this.querySelector(`.product-media--featured[data-id='${e}'] > *`);"small"!==theme.mqs.current_window&&i&&i.trigger("playMedia"),"image"!==i.parentNode.getAttribute("data-media-type")&&i.focus()}})}}customElements.define("product-media-root",ProductMedia);