class Carousel extends HTMLElement{constructor(){super()}connectedCallback(){this.blocks=this.querySelectorAll(".carousel--block"),this.container=this.querySelector(".carousel--x-container"),this.dot_nav=this.querySelector(".carousel--dot-nav"),this.dots=this.querySelectorAll(".carousel--dot"),this.height_container=this.querySelector(".carousel--y-container"),this.links=this.container.querySelectorAll("a"),this.next=this.querySelector(".carousel--next"),this.prev=this.querySelector(".carousel--prev"),this.at_end="true"===this.getAttribute("data-at-end"),this.at_start="true"===this.getAttribute("data-at-start"),this.auto_rotate="true"===this.getAttribute("data-auto-rotate"),this.blocks_per_slide_desktop=parseInt(this.getAttribute("data-blocks-per-slide")),this.blocks_per_slide_mobile=parseInt(this.getAttribute("data-blocks-per-slide--mobile")),this.dot_nav_enabled="true"===this.getAttribute("data-dot-nav"),this.rotate_frequency=parseInt(this.getAttribute("data-rotate-frequency")),this.section_id=this.closest("[data-section-id]").getAttribute("data-section-id"),this.total_blocks=this.blocks.length,this.transition_type=this.getAttribute("data-transition-type"),this.active_slide=1,this.autoplay_focus_enabled=!1,this.slide_pause=!1,this.container_destination="0px",this.trailing_dot_index=0,this.leading_dot_index=0,this.dot_nav_offset=0,this.active_blocks=null,this.auto_slide_timer=null,this.blocks_per_slide=null,this.old_active_blocks=null,this.screen_size_loaded=null,this.slide_count=null,this.swipe_state=null,this.window_width=null,this.dot_change_type=null,"loading"===document.readyState?window.on("DOMContentLoaded",()=>this.load()):this.load()}load(){this.resizeListener(),this.initNewScreenSize(),this.getAllFocusableEl(),this.updateActive(),this.setSliderHeight(),this.mouseDownListener(),this.swipeListener(),this.arrowNavListeners(),this.blockListener(),"slide"===this.transition_type&&this.loadBlocks(),this.auto_rotate&&(this.autoSlide(),this.stopAutoSlideWhenInteracting()),this.trigger("loaded")}initNewScreenSize(){if("small"===theme.mqs.current_window){if("small"===this.screen_size_loaded)return;this.dot_nav.setAttribute("data-loaded",!1),this.screen_size_loaded="small",this.blocks_per_slide=this.blocks_per_slide_mobile,this.active_slide=Math.ceil((this.blocks_per_slide_desktop*(this.active_slide-1)+1)/this.blocks_per_slide_mobile)}else{if("medium-large"===this.screen_size_loaded)return;this.screen_size_loaded="medium-large",this.blocks_per_slide=this.blocks_per_slide_desktop,this.active_slide=Math.ceil((this.blocks_per_slide_mobile*(this.active_slide-1)+1)/this.blocks_per_slide_desktop)}this.slide_count=Math.ceil(this.total_blocks/this.blocks_per_slide),this.createDotNav(),this.dotNavListeners(),this.goToActiveSlide(),this.updateActiveDot()}getAllFocusableEl(){this.focusable_el=theme.a11y.getFocusableEl(this)}loadBlocks(){this.blocks.forEach(t=>{t.setAttribute("data-loaded",!0),t.setAttribute("data-loaded--mobile",!0)})}blockListener(){this.blocks.on("theme:block:select",t=>{this.active_slide=Math.ceil((t.target.index()+1)/this.blocks_per_slide),this.updateActive(),this.goToActiveSlide(!0),this.updateActiveDot(),this.setSliderHeight()})}checkForActiveModel(t){const i=t.querySelector("model-viewer");if(i&&!i.classList.contains("shopify-model-viewer-ui__disabled"))return!0;return!1}mouseDownListener(){this.container.on("mousedown touchstart",t=>{var i=t.target.closest(".carousel--block");if(this.checkForActiveModel(i))return!1;this.swipe_state="swipe-started",this.reenableClickAfterSwiping(),this.mouseUpListener(),this.slide_pause=!0,"slide"===this.transition_type&&(this.drag_start=t.pageX,i=parseFloat(this.container.style.transform.replace(/[^0-9\-.,]/g,"")/100),this.current_transform_pixels=this.container.offsetWidth*i,this.container.setState(""),this.container.style.transform=`translateX(${this.current_transform_pixels}px)`,this.dragBegin())},!0)}mouseUpListener(){window.on(`mouseup.${this.section_id} touchend.`+this.section_id,()=>{this.swipe_state="swipe-ended",this.removeMouseUpListener(),this.dragEnd(),!0===this.slide_pause&&(this.container.setState("forwards"),this.container.style.transform=`translateX(${this.container_destination})`)},!0)}removeMouseUpListener(){window.off(`mouseup.${this.section_id} touchend.`+this.section_id)}dragBegin(){this.setAttribute("data-dragging",!0),window.on(`mousemove.${this.section_id} touchmove.`+this.section_id,t=>{let i=this.current_transform_pixels-this.drag_start+t.pageX;t=this.window_width*(this.slide_count-1);0<i?this.container.style.transform=`translateX(${i/4}px)`:i<-1*t?(i=t+((i*=-1)-t)/4,this.container.style.transform=`translateX(-${i}px)`):this.container.style.transform=`translateX(${i}px)`},!0)}dragEnd(){this.setAttribute("data-dragging",!1),window.off(`mousemove.${this.section_id} touchmove.`+this.section_id)}updateContainerDestination(){this.container_destination=(this.active_slide-1)/this.slide_count*-100+"%"}slideToNext(t=!1){this.dot_change_type="iterate";let i;return this.active_slide!==this.slide_count?(this.updateActive("next"),i="forwards"):t&&this.active_slide===this.slide_count?(this.active_slide=1,this.updateActive(),i="forwards"):this.active_slide===this.slide_count&&(i="backwards"),"slide"===this.transition_type?(this.updateContainerDestination(),this.container.style.transform=`translateX(${this.container_destination})`):"fade"===this.transition_type&&this.fadeSlides(),this.container.setState(i),!0}slideToPrev(){this.dot_change_type="iterate";let t;return 1!==this.active_slide?(this.updateActive("prev"),t="forwards"):1===this.active_slide&&(t="backwards"),"slide"===this.transition_type?(this.updateContainerDestination(),this.container.style.transform=`translateX(${this.container_destination})`):"fade"===this.transition_type&&this.fadeSlides(),this.container.setState(t),!0}goToActiveSlide(t=!1){this.dot_change_type="init","slide"===this.transition_type?(this.updateContainerDestination(),this.container.style.transform=`translateX(${this.container_destination})`):"fade"===this.transition_type&&this.fadeSlides(),t&&this.container.setState("forwards")}checkStartEnd(){1===this.active_slide?(this.at_start=!0,this.prev&&this.prev.setAttribute("tabindex","-1")):(this.at_start=!1,this.prev&&this.prev.setAttribute("tabindex","0")),this.setAttribute("data-at-start",this.at_start),this.active_slide===this.slide_count?(this.at_end=!0,this.next&&this.next.setAttribute("tabindex","-1")):(this.at_end=!1,this.next&&this.next.setAttribute("tabindex","0")),this.setAttribute("data-at-end",this.at_end)}updateActive(t=!1){"next"===t?(this.active_slide+=1,!this.autoplay_focus_enabled&&!1!==this.auto_rotate||this.prev.focus()):"prev"===t&&(--this.active_slide,!this.autoplay_focus_enabled&&!1!==this.auto_rotate||this.next.focus());var t=(this.active_slide-1)*this.blocks_per_slide,i=t+this.blocks_per_slide;null!==this.active_blocks&&(this.old_active_blocks=this.active_blocks),this.active_blocks=[...this.blocks].slice(t,i),this.toggleFocusableEl(),this.checkStartEnd()}toggleFocusableEl(){this.disabled_el&&this.disabled_el.forEach(t=>t.setAttribute("tabindex","0")),this.disabled_el=[];const t=this.blocks.not(this.active_blocks);t.forEach(t=>{const i=theme.a11y.getFocusableEl(t);i.forEach(t=>this.disabled_el.push(t))}),this.disabled_el.length&&this.disabled_el.forEach(t=>t.setAttribute("tabindex","-1"))}setSliderHeight(){let i=0;this.active_blocks.forEach(t=>{t=t.offsetHeight;t>i&&(i=t)}),this.height_container.style.height=i+"px"}swipeListener(){document.documentElement.on("theme:swipe:left",()=>{"swipe-started"===this.swipe_state&&(this.slide_pause=!1,this.slideToNext(),this.setSliderHeight(),this.updateActiveDot(),this.preventClickWhenSwiping())}),document.documentElement.on("theme:swipe:right",()=>{"swipe-started"===this.swipe_state&&(this.slide_pause=!1,this.slideToPrev(),this.setSliderHeight(),this.updateActiveDot(),this.preventClickWhenSwiping())})}createDotNav(){if(this.dot_nav_enabled&&1!==this.slide_count){this.dot_nav&&(this.dot_nav.innerHTML="");for(let t=0;t<this.slide_count;t++){var i=theme.utils.parseHtml('<div class="carousel--dot"></div>');this.dot_nav&&this.dot_nav.appendChild(i)}this.dots=this.dot_nav.querySelectorAll(".carousel--dot"),"small"===theme.mqs.current_window&&this.dots.forEach(t=>t.setAttribute("tabindex","0"))}}updateActiveDot(){this.dots.forEach(t=>t.setAttribute("data-active",!1)),this.dots[this.active_slide-1]&&this.dots[this.active_slide-1].setAttribute("data-active",!0),5<this.dots.length?this.updateTrailingLeadingDots():(this.alignDots(),this.dot_nav.setAttribute("data-loaded",!0))}updateTrailingLeadingDots(){if(this.active_slide===this.leading_dot_index){this.leading_dot_index++,this.trailing_dot_index++;const t=this.dots[this.active_slide-1];t.setAttribute("data-position",""),this.initial_offset=t.offset().left,setTimeout(()=>{if(4<=this.active_slide&&this.dots[this.active_slide-4].setAttribute("data-position","trailing-1"),5<=this.active_slide){this.dots[this.active_slide-5].setAttribute("data-position","trailing-2");const i=this.dot_nav.querySelectorAll(`.carousel--dot:nth-child(-n+${this.active_slide-5})`);i.forEach(t=>t.setAttribute("data-position","hidden"))}this.dots.length>this.active_slide&&this.dots[this.active_slide].setAttribute("data-position","leading-1"),this.dots.length>this.active_slide+1&&this.dots[this.active_slide+1].setAttribute("data-position","leading-2");const t=this.dot_nav.querySelectorAll(`.carousel--dot:nth-child(n+${this.active_slide+3})`);t.forEach(t=>t.setAttribute("data-position","hidden")),this.alignDots(this.initial_offset),"init"===this.dot_change_type&&(this.alignDots(),this.dot_nav.setAttribute("data-loaded",!0))},0),setTimeout(()=>{this.dot_nav.setState(!0),this.alignDots()},200)}else if(this.active_slide===this.trailing_dot_index){this.leading_dot_index--,this.trailing_dot_index--;const i=this.dots[this.active_slide-1];i.setAttribute("data-position",""),setTimeout(()=>{2<=this.active_slide&&this.dots[this.active_slide-2].setAttribute("data-position","trailing-1"),3<=this.active_slide&&this.dots[this.active_slide-3].setAttribute("data-position","trailing-2"),this.dots.length>this.active_slide+2&&this.dots[this.active_slide+2].setAttribute("data-position","leading-1"),this.dots.length>this.active_slide+3&&this.dots[this.active_slide+3].setAttribute("data-position","leading-2");const t=this.dot_nav.querySelectorAll(`.carousel--dot:nth-child(n+${this.active_slide+5})`);if(t.forEach(t=>t.setAttribute("data-position","hidden")),4<=this.active_slide){const i=this.dot_nav.querySelectorAll(`.carousel--dot:nth-child(-n+${this.active_slide-2})`);i.forEach(t=>t.setAttribute("data-position","hidden"))}this.alignDots(this.initial_offset),"init"===this.dot_change_type&&(this.alignDots(),this.dot_nav.setAttribute("data-loaded",!0))},0),setTimeout(()=>{this.dot_nav.setState(!0),this.alignDots()},200)}else"init"===this.dot_change_type&&(this.dots.forEach(t=>t.setAttribute("data-position","")),this.slide_count-this.active_slide<=2?(this.leading_dot_index=this.active_slide,this.trailing_dot_index=this.active_slide-3):2<this.slide_count-this.active_slide&&(this.trailing_dot_index=this.active_slide,this.leading_dot_index=this.active_slide+3),this.updateTrailingLeadingDots())}alignDots(t=!1){if(t){const e=this.dots[this.active_slide-1];var i=e.offset().left,t=this.dot_nav_offset+(t-i)+"px";this.dot_nav.setState(!1),this.dot_nav.style.transform=`translateX(${t})`}else this.dot_nav_offset=(this.offsetWidth-this.dot_nav.offsetWidth)/2,this.dot_nav.style.transform=`translateX(${this.dot_nav_offset}px)`}dotNavListeners(){this.dots.off(`click.${this.section_id} keydown.`+this.section_id),this.dots.on(`click.${this.section_id} keydown.`+this.section_id,t=>{"keydown"===t.type&&"Enter"!==t.key||(this.active_slide=t.target.index()+1,this.updateActive(),this.goToActiveSlide(!0),this.setSliderHeight(),this.updateActiveDot())})}arrowNavListeners(){this.prev.on("click keydown",t=>{"keydown"===t.type&&"Enter"!==t.key||(this.slideToPrev(),this.setSliderHeight(),this.updateActiveDot())}),this.next.on("click keydown",t=>{"keydown"===t.type&&"Enter"!==t.key||(this.slideToNext(),this.setSliderHeight(),this.updateActiveDot())})}resizeListener(){this.window_width=document.documentElement.clientWidth,window.on(`resize.${this.section_id} theme:carousel:imagesResized`,theme.utils.debounce(100,()=>{this.window_width=document.documentElement.clientWidth,this.initNewScreenSize(),this.updateActive(),this.setSliderHeight(),this.alignDots(),"small"===theme.mqs.current_window?this.dots.forEach(t=>t.setAttribute("tabindex","0")):this.dots.forEach(t=>t.removeAttribute("tabindex"))}))}reenableClickAfterSwiping(){this.links.off("click."+this.section_id)}preventClickWhenSwiping(){this.links.on("click."+this.section_id,t=>t.preventDefault())}autoSlide(){this.auto_slide_timer=setInterval(()=>{this.slideToNext(!0),this.updateActiveDot(),this.setSliderHeight()},1e3*this.rotate_frequency)}stopAutoSlideWhenInteracting(){this.on("click touchstart",()=>{this.autoplay_focus_enabled=!0,clearInterval(this.auto_slide_timer),this.off("click touchstart")},!0),this.focusable_el.on("focus",()=>{this.autoplay_focus_enabled=!0,clearInterval(this.auto_slide_timer),this.focusable_el.off("focus")},!0)}fadeSlides(){null!==this.active_blocks&&null!==this.old_active_blocks&&(this.blocks.forEach(t=>{t.setAttribute("data-active",""),t.setAttribute("data-loaded",!1),t.setAttribute("data-loaded--mobile",!1)}),this.old_active_blocks.forEach(t=>{t.setAttribute("data-active","old"),t.style.left="0%"}),this.active_blocks.forEach((t,i)=>{t.setAttribute("data-active","new"),t.style.left=100*i/this.total_blocks+"%"}))}updateThenGoToActiveSlide(t){this.active_slide=t,this.updateActive(),this.goToActiveSlide(),this.setSliderHeight(),this.updateActiveDot()}}customElements.define("carousel-root",Carousel);